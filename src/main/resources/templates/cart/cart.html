<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Your Cart</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">
    <!-- 기존 스타일시트들 -->
    <link rel="stylesheet" href="/css/output.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/dropDown_form01.css">
    <link rel="stylesheet" href="/css/category_form01.css">
    <link rel="stylesheet" href="/css/pagination_form01.css">
    <link rel="stylesheet" href="/css/itemCount_form01.css">
    <link rel="stylesheet" href="/css/mobileMenu_form01.css">
    <link rel="stylesheet" href="/css/search_form01.css">
</head>
<body class="bg-gray-100">

<!-- 검색 모달 -->
<div th:replace="~{forms/search_form01.html :: searchProduct01}"></div>

<!-- Header -->
<div th:replace="~{header/header.html :: header}"></div>

<!-- 장바구니 화면 -->
<main class="container mx-auto px-4">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-blue-600">장바구니</h1>
    </div>

    <!-- 장바구니가 비어있지 않을 때 -->
    <div th:if="${cart.products != null and cart.products.size() > 0}">
        <table class="w-full bg-white border border-gray-300 rounded-lg shadow-lg">
            <thead class="bg-gray-800 text-white">
            <tr>
                <th class="p-4 text-left">Product Image</th>
                <th class="p-4 text-left">Product ID</th>
                <th class="p-4 text-left">Product Name</th>
                <th class="p-4 text-right">Price (KRW)</th>
                <th class="p-4 text-center">Quantity</th>
                <th class="p-4 text-right">Total (KRW)</th>
                <th class="p-4 text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${cart.products}" class="border-b border-gray-200 hover:bg-gray-100">
                <td class="p-4">
                    <img th:src="@{${product.imgurl}}" alt="Product Image" class="w-20 h-auto rounded"/>
                </td>
                <td class="p-4" th:text="${product.indexId}">Product ID</td>
                <td class="p-4" th:text="${product.productName}">Product Name</td>
                <td class="p-4 text-right text-blue-600 font-bold" th:text="'₩' + ${#numbers.formatDecimal(product.productPrice, 0, 'COMMA', 0, 'POINT')}">Price</td>
                <td class="p-4 text-center">
                    <!-- 상품 수량 변경 폼 -->
                    <form th:action="@{/cart/update}" method="post">
                        <input type="hidden" name="productId" th:value="${product.indexId}" />
                        <input type="number" name="quantity" th:value="${product.quantity}" min="1" class="w-12 p-1 border rounded text-center"/>
                        <button type="submit" class="ml-2 px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">Update</button>
                    </form>
                </td>
                <td class="p-4 text-right text-blue-600 font-bold" th:text="'₩' + ${#numbers.formatDecimal(product.productPrice * product.quantity, 0, 'COMMA', 0, 'POINT')}">Total</td>
                <td class="p-4 text-center">
                    <!-- 상품 삭제 폼 -->
                    <form th:action="@{/cart/delete}" method="post">
                        <input type="hidden" name="productId" th:value="${product.indexId}" />
                        <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Delete</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- 장바구니 요약 -->
        <div class="mt-8 text-right">
            <div class="text-xl font-semibold">
                <span>Total: </span>
                <span class="text-blue-600" th:text="'₩' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')}">₩0</span>
            </div>
            <div class="mt-4">
                <a href="/" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>
                <a href="/checkout" class="inline-block px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 ml-4 shadow-md transition duration-300">💳 결제하기</a>
            </div>
        </div>
    </div>

    <!-- 빈 장바구니 메시지 -->
    <div th:if="${cart.products == null or cart.products.size() == 0}" class="text-center py-20">
        <h2 class="text-2xl font-semibold text-gray-700">장바구니가 비어 있습니다.</h2>
        <p class="mt-4 text-gray-500">쇼핑을 계속하여 필요한 상품을 추가해보세요.</p>
        <a href="/" class="inline-block mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>
    </div>
</main>

<!-- Footer -->
<div th:replace="~{footer/footer.html :: footer}"></div>

<!-- 스크립트 파일들 -->
<script src="/js/header.js"></script>
<script src="/js/dropDown_form01.js"></script>
<script src="/js/mobileMenu_form01.js"></script>
<script src="/js/search_form01.js"></script>
</body>
</html>
