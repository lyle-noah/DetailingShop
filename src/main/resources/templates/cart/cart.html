<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Your Cart</title>-->
<!--    &lt;!&ndash; Tailwind CSS CDN &ndash;&gt;-->
<!--    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">-->
<!--    &lt;!&ndash; 기존 스타일시트들 &ndash;&gt;-->
<!--    <link rel="stylesheet" href="/css/output.css">-->
<!--    <link rel="stylesheet" href="/css/header.css">-->
<!--    <link rel="stylesheet" href="/css/dropDown_form01.css">-->
<!--    <link rel="stylesheet" href="/css/category_form01.css">-->
<!--    <link rel="stylesheet" href="/css/pagination_form01.css">-->
<!--    <link rel="stylesheet" href="/css/itemCount_form01.css">-->
<!--    <link rel="stylesheet" href="/css/mobileMenu_form01.css">-->
<!--    <link rel="stylesheet" href="/css/search_form01.css">-->
<!--    <link rel="stylesheet" href="/css/cart.css">-->
<!--</head>-->
<!--<body class="bg-gray-100">-->

<!--&lt;!&ndash; 검색 모달 &ndash;&gt;-->
<!--<div th:replace="~{forms/search_form01.html :: searchProduct01}"></div>-->

<!--&lt;!&ndash; Header &ndash;&gt;-->
<!--<div th:replace="~{header/header.html :: header}"></div>-->

<!--&lt;!&ndash; 장바구니 화면 &ndash;&gt;-->
<!--<main class="container mx-auto px-4">-->
<!--    <div class="text-center mb-8">-->
<!--        <h1 class="text-4xl font-bold text-blue-600">장바구니</h1>-->
<!--    </div>-->

<!--    &lt;!&ndash; 장바구니가 비어있지 않을 때 &ndash;&gt;-->
<!--    <div th:if="${cart.products != null and cart.products.size() > 0}">-->
<!--        <table class="w-full bg-white border border-gray-300 rounded-lg shadow-lg">-->
<!--            <thead class="bg-gray-800 text-white">-->
<!--            <tr>-->
<!--                <th class="p-4 text-left">상품 이미지</th>-->
<!--                <th class="p-4 text-left">상품명</th>-->
<!--                <th class="p-4 text-right">가격 (KRW)</th>-->
<!--                <th class="p-4 text-center">수량</th>-->
<!--                <th class="p-4 text-center">삭제</th>-->
<!--            </tr>-->
<!--            </thead>-->
<!--            <tbody>-->
<!--            &lt;!&ndash; 전체 선택 체크박스 &ndash;&gt;-->
<!--            <tr>-->
<!--                <td colspan="5" class="p-4 text-left">-->
<!--                    <input type="checkbox" id="select-all" class="mr-2"> 전체 선택-->
<!--                </td>-->
<!--            </tr>-->
<!--            <tr th:each="product : ${cart.products}" class="border-b border-gray-200 hover:bg-gray-100">-->
<!--                <td class="p-4">-->
<!--                    &lt;!&ndash; 각 상품별 체크박스 &ndash;&gt;-->
<!--                    <input type="checkbox" name="productCheckbox" class="mr-2">-->
<!--                    <img th:src="@{${product.imgurl}}" alt="Product Image" class="w-20 h-auto rounded"/>-->
<!--                </td>-->
<!--                <td class="p-4" th:text="${product.productName}">Product Name</td>-->
<!--                <td class="p-4 text-right text-blue-600 font-bold" th:text="'₩' + ${#numbers.formatDecimal(product.productPrice, 0, 'COMMA', 0, 'POINT')}">Price</td>-->
<!--                <td class="p-4 text-center">-->
<!--                    <form th:action="@{/cart/update}" method="post">-->
<!--                        <input type="hidden" name="productId" th:value="${product.indexId}" />-->
<!--                        <input type="number" name="quantity" th:value="${product.quantity}" min="1" class="w-16 p-2 border rounded text-center"/>-->
<!--                    </form>-->
<!--                </td>-->
<!--                <td class="p-4 text-center">-->
<!--                    &lt;!&ndash; 상품 삭제 폼 &ndash;&gt;-->
<!--                    <form th:action="@{/cart/delete}" method="post">-->
<!--                        <input type="hidden" name="productId" th:value="${product.indexId}" />-->
<!--                        <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">❌ 삭제</button>-->
<!--                    </form>-->
<!--                </td>-->
<!--            </tr>-->
<!--            </tbody>-->
<!--        </table>-->

<!--        &lt;!&ndash; 장바구니 요약 &ndash;&gt;-->
<!--        <div class="mt-8 text-right">-->
<!--            <div class="text-xl font-semibold">-->
<!--                <span>총 금액: </span>-->
<!--                <span class="text-blue-600" th:text="'₩' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')}">₩0</span>-->
<!--            </div>-->
<!--            <div class="mt-4">-->
<!--                <a href="/" class="inline-block px-6 py-3 bg-blue-600 text-white hover:text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>-->
<!--                <a href="/pay" class="inline-block px-6 py-3 bg-green-600 text-white hover:text-white rounded-lg hover:bg-green-700 ml-4 shadow-md transition duration-300">💳 결제하기</a>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->


<!--    &lt;!&ndash; 빈 장바구니 메시지 &ndash;&gt;-->
<!--    <div th:if="${cart.products == null or cart.products.size() == 0}" class="text-center py-20">-->
<!--        <h2 class="text-2xl font-semibold text-gray-700">장바구니가 비어 있습니다.</h2>-->
<!--        <p class="mt-4 text-gray-500">쇼핑을 계속하여 필요한 상품을 추가해보세요.</p>-->
<!--        <a href="/" class="inline-block mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>-->
<!--    </div>-->
<!--</main>-->

<!--&lt;!&ndash; Footer &ndash;&gt;-->
<!--<div th:replace="~{footer/footer.html :: footer}"></div>-->

<!--&lt;!&ndash; 스크립트 파일들 &ndash;&gt;-->
<!--<script src="/js/header.js"></script>-->
<!--<script src="/js/dropDown_form01.js"></script>-->
<!--<script src="/js/mobileMenu_form01.js"></script>-->
<!--<script src="/js/search_form01.js"></script>-->

<!--&lt;!&ndash; 전체 선택 기능 스크립트 &ndash;&gt;-->
<!--<script>-->
<!--    // 전체 선택 기능-->
<!--    document.getElementById('select-all').addEventListener('change', function(e) {-->
<!--        const checkboxes = document.querySelectorAll('input[name="productCheckbox"]');-->
<!--        checkboxes.forEach(checkbox => {-->
<!--            checkbox.checked = e.target.checked;-->
<!--        });-->
<!--    });-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Your Cart</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">
    <!-- 기존 스타일시트들 -->
    <link rel="stylesheet" href="/css/output.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/dropDown_form01.css">
    <link rel="stylesheet" href="/css/category_form01.css">
    <link rel="stylesheet" href="/css/pagination_form01.css">
    <link rel="stylesheet" href="/css/itemCount_form01.css">
    <link rel="stylesheet" href="/css/mobileMenu_form01.css">
    <link rel="stylesheet" href="/css/search_form01.css">
    <link rel="stylesheet" href="/css/cart.css">
</head>
<body class="bg-gray-100">

<!-- 검색 모달 -->
<div th:replace="~{forms/search_form01.html :: searchProduct01}"></div>

<!-- Header -->
<div th:replace="~{header/header.html :: header}"></div>

<!-- 장바구니 화면 -->
<main class="container mx-auto px-4">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-blue-600">장바구니</h1>
    </div>

    <!-- 장바구니가 비어있지 않을 때 -->
    <div th:if="${cart.products != null and cart.products.size() > 0}">
        <table class="w-full bg-white border border-gray-300 rounded-lg shadow-lg">
            <thead class="bg-gray-800 text-white">
            <tr>
                <th class="p-4 text-left">상품 이미지</th>
                <th class="p-4 text-left">상품명</th>
                <th class="p-4 text-right">가격 (KRW)</th>
                <th class="p-4 text-center">수량</th>
                <th class="p-4 text-center">삭제</th>
            </tr>
            </thead>
            <tbody>
            <!-- 전체 선택 체크박스 -->
            <tr>
                <td colspan="5" class="p-4 text-left">
                    <input type="checkbox" id="select-all" class="mr-2"> 전체 선택
                </td>
            </tr>
            <tr th:each="product : ${cart.products}" class="border-b border-gray-200 hover:bg-gray-100">
                <td class="p-4">
                    <!-- 각 상품별 체크박스 -->
                    <input type="checkbox" name="productCheckbox" class="mr-2">
                    <img th:src="@{${product.imgurl}}" alt="Product Image" class="w-20 h-auto rounded"/>
                </td>
                <td class="p-4" th:text="${product.productName}">Product Name</td>
                <td class="p-4 text-right text-blue-600 font-bold" th:text="'₩' + ${#numbers.formatDecimal(product.productPrice, 0, 'COMMA', 0, 'POINT')}">Price</td>
                <td class="p-4 text-center">
                    <form class="update-form" th:action="@{/cart/update}" method="post">
                        <input type="hidden" name="productId" th:value="${product.indexId}" />
                        <input type="number" name="quantity" th:value="${product.quantity}" min="1" class="w-16 p-2 border rounded text-center" oninput="updateTotalPrice(this)" />
                    </form>
                </td>
                <td class="p-4 text-center">
                    <!-- 상품 삭제 폼 -->
                    <form th:action="@{/cart/delete}" method="post">
                        <input type="hidden" name="productId" th:value="${product.indexId}" />
                        <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">❌ 삭제</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- 장바구니 요약 -->
        <div class="mt-8 text-right">
            <div class="text-xl font-semibold">
                <span>총 금액: </span>
                <span id="total-price" class="text-blue-600" th:text="'₩' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')}">₩0</span>
            </div>
            <div class="mt-4">
                <a href="/" class="inline-block px-6 py-3 bg-blue-600 text-white hover:text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>
                <a href="/pay" class="inline-block px-6 py-3 bg-green-600 text-white hover:text-white rounded-lg hover:bg-green-700 ml-4 shadow-md transition duration-300">💳 결제하기</a>
            </div>
        </div>
    </div>

    <!-- 빈 장바구니 메시지 -->
    <div th:if="${cart.products == null or cart.products.size() == 0}" class="text-center py-20">
        <h2 class="text-2xl font-semibold text-gray-700">장바구니가 비어 있습니다.</h2>
        <p class="mt-4 text-gray-500">쇼핑을 계속하여 필요한 상품을 추가해보세요.</p>
        <a href="/" class="inline-block mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition duration-300">🛍️ 쇼핑 계속하기</a>
    </div>
</main>

<!-- Footer -->
<div th:replace="~{footer/footer.html :: footer}"></div>

<!-- 스크립트 파일들 -->
<script src="/js/header.js"></script>
<script src="/js/dropDown_form01.js"></script>
<script src="/js/mobileMenu_form01.js"></script>
<script src="/js/search_form01.js"></script>

<!-- 전체 선택 기능 스크립트 -->
<script>
    // 전체 선택 기능
    document.getElementById('select-all').addEventListener('change', function(e) {
        const checkboxes = document.querySelectorAll('input[name="productCheckbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = e.target.checked;
        });
    });

    // 수량 변경 시 총 금액 업데이트
function updateTotalPrice(input) {
    const form = input.closest('form');
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Accept': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.totalPrice !== undefined) {
            document.getElementById('total-price').innerText = '₩' + new Intl.NumberFormat().format(data.totalPrice);
        } else if (data.error) {
            console.error('Error:', data.error);
        }
    })
    .catch(error => console.error('Error updating total price:', error));
}
</script>

</body>
</html>
